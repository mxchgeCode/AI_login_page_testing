# Система Автоматического Тестирования

Эта система автоматически генерирует и обновляет тесты при изменении кода в `app.py`.

## Компоненты системы

### Основные файлы:
- `app.py` - основной файл с кодом приложения
- `test_generated.py` - автоматически генерируемые тесты
- `test_config.json` - конфигурация системы
- `app_hash.txt` - хэш основного файла для отслеживания изменений

### Модули системы:
- `code_tracker.py` - отслеживание изменений в коде
- `test_validator.py` - проверка актуальности существующих тестов
- `smart_test_generator.py` - генерация новых тестов для измененного кода
- `test_runner.py` - запуск всех тестов

### Конфигурация:
- `.github/workflows/auto_test.yml` - GitHub Actions для автоматического запуска
- `requirements.txt` - зависимости Python

## Как работает система

### 1. Отслеживание изменений
Система вычисляет SHA-256 хэш файла `app.py` и сравнивает его с предыдущим значением.

### 2. Проверка актуальности тестов
При изменении кода система анализирует существующие тесты и определяет:
- Какие функции все еще существуют в коде
- Какие тесты покрывают несуществующие функции
- Устаревшие тесты удаляются автоматически

### 3. Генерация новых тестов
Для новых функций, которые не покрыты тестами, система генерирует новые тесты с помощью AI.

### 4. Запуск тестов
Все тесты (новые и старые) запускаются автоматически.

## Использование

### Локальное использование

1. **Установка зависимостей:**
```bash
pip install -r requirements.txt
playwright install chromium
```

2. **Настройка API ключа:**
```bash
export OPENROUTER_API_KEY="your-api-key-here"
```

3. **Генерация тестов:**
```bash
python smart_test_generator.py
```

4. **Запуск всех тестов:**
```bash
python test_runner.py
```

5. **Только запуск существующих тестов:**
```bash
python test_runner.py --tests-only
```

### Автоматическое использование с GitHub

1. Добавьте ваш `OPENROUTER_API_KEY` в секреты репозитория (Settings > Secrets and variables > Actions)

2. При каждом push в ветку `main`, `master` или `develop` система автоматически:
   - Проверит изменения в `app.py`
   - Сгенерирует новые тесты при необходимости
   - Запустит все тесты
   - Загрузит результаты как артефакт

## Конфигурация

Настройки системы хранятся в `test_config.json`:

```json
{
  "app_file": "app.py",
  "tests_file": "test_generated.py",
  "hash_file": "app_hash.txt",
  "last_analysis": null,
  "test_history": [],
  "settings": {
    "auto_generate": true,
    "validate_existing_tests": true,
    "run_tests_after_generation": true,
    "api_model": "deepseek/deepseek-chat-v3.1:free",
    "max_tokens": 2000,
    "temperature": 0
  }
}
```

## Процесс работы

1. **Мониторинг изменений:** При запуске система проверяет хэш `app.py`
2. **Анализ кода:** Извлекает все функции из основного файла
3. **Валидация тестов:** Проверяет, что существующие тесты покрывают реальные функции
4. **Очистка:** Удаляет устаревшие тесты
5. **Генерация:** Создает новые тесты для новых функций
6. **Сохранение:** Обновляет хэш и сохраняет новые тесты
7. **Запуск:** Выполняет все тесты

## Преимущества системы

- ✅ Автоматическая генерация тестов при изменении кода
- ✅ Проверка актуальности существующих тестов
- ✅ Удаление устаревших тестов
- ✅ Интеграция с GitHub Actions
- ✅ Подробные отчеты о тестировании
- ✅ Гибкая конфигурация

## Требования

- Python 3.9+
- Playwright для браузерных тестов
- OPENROUTER_API_KEY для генерации тестов
- GitHub репозиторий для автоматического запуска

## Возможные проблемы

1. **API ключ не установлен:** Убедитесь, что переменная окружения `OPENROUTER_API_KEY` установлена
2. **Синтаксические ошибки:** Система попытается сгенерировать тесты даже при ошибках в коде
3. **Долгое выполнение:** Тесты с браузерными взаимодействиями могут выполняться долго

## Расширение системы

Система легко расширяется для поддержки:
- Дополнительных типов тестов (интеграционные, нагрузочные)
- Различных AI моделей для генерации тестов
- Интеграции с другими CI/CD системами
- Поддержки нескольких файлов с кодом